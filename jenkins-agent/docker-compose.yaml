# Jenkins Agent for Remote VMs
#
# This file is deployed by Jenkinsfile.agent-setup
# Environment variables are set via .env file (auto-generated)

services:
  jenkins-agent:
    build:
      context: .
      dockerfile: Dockerfile
    image: jenkins-agent-docker:latest
    container_name: jenkins-agent
    restart: unless-stopped
    
    environment:
      - JENKINS_URL=${JENKINS_URL}
      - JENKINS_AGENT_NAME=${JENKINS_AGENT_NAME}
      - JENKINS_SECRET=${JENKINS_SECRET}
      - JENKINS_AGENT_WORKDIR=/home/jenkins/agent
    
    volumes:
      # Deployment directory - where deployments are stored persistently
      - /home/jenkins-agent:/home/jenkins-agent
      # Docker socket - allows agent to run Docker commands
      - /var/run/docker.sock:/var/run/docker.sock
    
    # Docker socket group - must match host's docker GID
    group_add:
      - "${DOCKER_GID}"
